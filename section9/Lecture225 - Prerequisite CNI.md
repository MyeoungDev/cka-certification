# Lecture 225 - Prerequisite CNI

- Network Namespace 는 단일 호스트에 격리된 네트워크 환경을 생성한다.
- 네임스페에스는 네임스페이스 간 통신을 위한 가상 인터페이스 를 설정하는 브리지 네트워크로 상호 연결된다.
- 여기서 IP 주소 할당, 인터페이스 활성화, 외부 연결을 위한 NAT 또는 IP 메스커레이딩 활성화가 포함된다.
- Kubernetes 같은 컨테이너 플랫폼도 위와 비슷한 방식으로 네트워크 문제를 해결한다.
- 위와 같은 프로세슬르 표준화하고 여러 플랫폼에서 중복되는 작업을 방지하기 위해 "Bridge" 라는 전용 프로그램이 개발되었다.
- 이 프로그램은 컨테이너를 Bridge Network 에 연결하는 데 필요한 작업을 자동화한다.
- Bride 프로그램은 저수준 네트워킹 구성을 처리하여 컨테이너 런타임 환경의 복잡성을 낮춘다.
- Kubernetes 같은 컨테이너 플랫폼은 새 컨테이너를 시작할 때 컨테이너 ID 와 네임스페이스를 전달하여 Bridge 프로그램을 호출하여 네트워크를 자동으로 설정한다.

```bash
$ bridge add 2e34dcf34 /var/run/netns/2e34dcf34

```

- 네트워크 구성 작업을 표준화된 브리지 프로그램을 사용함으로써 컨테이너 런타임은 CNI 호환 플러그인을 통해 일관되고 안정적인 네트워크 설정을 보장함과 동시에 더 높은 수준의 작업에 집중할 수 있다.
- 이 처럼 컨테이너 런타임과의 호환성을 보자앟기 위해 컨테이너 네트워킹 인터페이스 (CNI) 가 사용된다.
- CNI 는 컨터이너 런타임 환경과 네트워크 플러그인을 생성하고 통합하기 위한 표준을 정의한다.

### CNI 플러그인 역할

- 각 컨테이너에 대한 네트워크 네임스페이스 생성
- 컨테이너에 연결해야 하는 네트워크 식별
- 컨테이너가 생성될 때 네트워크를 구성. (`add` 명령어)
- 컨테이너가 삭제될 때 정리. (`del` 명령어)
- JSON 구성 파일을 통해 필요한 네트워크 세부 정보를 설정.

CNI 플러그인은 `add`, `del`, `check` 의 세 가지 인수를 지원해야 한다.

이를 통해 플러그인이 컨테이너 간 효율적인 통신을 보장한다.

출력은 일관성을 위해 엄격한 형식을 따라야 한다.

- 컨테이너 런타임과 네트워크 플러그인 모두 CNI 표준을 준수하면 원활한 상호 운용성이 확보된다.
- 모든 CNI 호환 플러그인은 표준을 지원하는 모든 컨테이너 런타임과 호환된다.

### Docker 에서 CNI 사용

- Docker 는 CNI 와 다른 컨테이너 네트워크 모델 (CNM) 이라는 자체 네트워킹 표준을 사용한다.
- Docker 에서 CNI 를 사용하려면 네트워크 구성 없이 컨테이너를 생성해야 한다.
- CNI 플러그인을 수동으로 호출하여 네트워킹을 설정해야 한다.

```bash
docker run --network=none nginxbridge add 2e34dcf34 /var/run/netns/2e34dcf34
```