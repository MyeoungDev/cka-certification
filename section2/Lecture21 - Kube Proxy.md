# Lecture 21 - Kube Proxy

## 쿠버네티스의 Pod Networking

- 쿠버네티스는 강력한 파드 네트워킹 솔루션을 구축하여 클러스터 내의 모든 파드가 서로 통신할 수 있도록 한다.
- 이를 통해 **모든 노드를 아우르는 내부 가상 네트워크가 생성**되어 **모든 파드를 연결**한다.
- 예를들어 웹 애플리케이션이 데이터베이스에 접근한다고 가정할 때, 데이터베이스 파드의 IP 주소는 언제든지 변경될 수 있다.
- 이를 해결하기 위해 Service를 생성하여 데이터베이스 애플리케이션을 클러스터에 노출시켜서 통신하게 만든다.

> NOTE
>
> - Service 는 실제 파드처럼 컨테이너나 인터페이스를 가지지 않고, 쿠버네티스 메모리에만 존재하는 "가상의 구성 요소" 이다.
> - 클러스터 메모리에 영구적인 엔드포인트를 제공하여 파드에 안정적으로 액세스할 수 있도록 한다.

## Kube Proxy 동작 방식

- Kube Proxy 는 쿠버네티스 클러스터의 모든 노드에서 실행되는 경량 프로세스이다.
- 주요 기능은 서비스 생성을 모니터링하고, 해당 파드로 트래픽을 리디렉션하는 네트워크 규칙을 구성하는 것이다.
- 일반적으로 사용되는 방식 중 하나는 IP 테이블 규칙을 설정하는 것이다.
- 만약, 서비스의 IP 가 10.96.0.12 로 할당되면  Kube Proxy 는 각 노드의 IP 테이블을 구성하여, 해당 IP로 향하는 모든 트래픽이 10.32.0.15 와 같은 실제 파드 IP 로 전달되도록 한다.

## Kube Proxy 설치

### 바이너리 설치

- https://github.com/kubernetes/kubernetes/releases
- 쿠버네티스 릴리즈 페이지에서 바이너리 파일로 설치한다.

### kubeadm 설치

- 일반적으로 `kubeadm` 을 사용할 경우 `DaemonSet` 으로 배포된다.
- 이 방식의 경우 클러스터의 모든 노드에서 단일 Kube Proxy 파드가 실행되도록 보장할 수 있다.

```bash
$ kubectl get pods -n kube-system
$ kubectl get daemonset -n kube-system
```